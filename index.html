<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Steganografi di Gambar</title>
</head>
<body>
  <h2>Steganografi LSB</h2>
  <input type="file" id="imageInput">
  <textarea id="message" placeholder="Masukkan pesan"></textarea>
  <button onclick="encodeMessage()">Sisipkan Pesan</button>
  <button onclick="decodeMessage()">Ekstrak Pesan</button>
  <label for="#channel">Channel: </label>
  <select id="channel">
    <option value="r">R</option>
    <option value="g">G</option>
    <option value="b">B</option>
  </select>
  <div id="result"></div>
  <canvas id="canvas" style="display:none;"></canvas>
  <script>
    const c = document.getElementById('channel');
    
    function encodeMessage() {
      let file = document.getElementById("imageInput").files[0];
      let message = document.getElementById("message").value;
      if (!file || !message) return alert("Pilih gambar dan masukkan pesan!");
      let reader = new FileReader();
      reader.onload = function(event) {
        let img = new Image();
        img.onload = function() {
          let canvas = document.getElementById("canvas");
          let ctx = canvas.getContext("2d");
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          
          let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          let data = imageData.data;
          
          let binary = "";
          for (let i = 0; i < message.length; i++) {
            binary += message.charCodeAt(i).toString(2).padStart(8, '0');
          }
          binary += "00000000";
          
          if (binary.length > canvas.width * canvas.height) alert("Pesan terlalu panjang!");
          
          for (let i = 0; i < binary.length; i++) {
            let bit = parseInt(binary[i]);
            
            let idx = i * 4 + (c.value === 'r' ? 0 : c.value === 'g' ? 1 : 2);
            
            data[idx] = (data[idx] & 0xFE) | bit;
          }
          
          ctx.putImageData(imageData, 0, 0);
          let encodedImage = canvas.toDataURL();
          let a = document.createElement("a");
          a.href = encodedImage;
          a.download = "encoded_image.png";
          a.click();
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }
    
    function decodeMessage() {
      let file = document.getElementById("imageInput").files[0];
      if (!file) return alert("Pilih gambar untuk diekstrak!");
      
      let reader = new FileReader();
      reader.onload = function(event) {
        let img = new Image();
        img.onload = function() {
          let canvas = document.getElementById("canvas");
          let ctx = canvas.getContext("2d");
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          
          let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          let data = imageData.data;
          
          let bits = "";
          for (let i = 0; i < data.length; i += 4) {
            let idx = i + (c.value === 'r' ? 0 : c.value === 'g' ? 1 : 2);
            
            let bit = data[idx] & 1;
            bits += bit;
            
            if (bits.length % 8 === 0) {
              let byte = bits.slice(bits.length - 8);
              if (byte === "00000000") break;
            }
          }
          
          let result = "";
          for (let i = 0; i < bits.length; i += 8) {
            let byte = bits.slice(i, i + 8);
            if (byte === "00000000") break;
            result += String.fromCharCode(parseInt(byte, 2));
          }
          
          document.getElementById('result').textContent = result;
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }
  </script>
</body>
</html>
